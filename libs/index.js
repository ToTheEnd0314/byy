/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};var e=function(){return(e=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function n(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n}function r(t){console.error("Moon Error:\n"+t)}function o(t){return"[object Object]"===Object.prototype.toString.call(t)}function i(t){return"[object String]"===Object.prototype.toString.call(t)}function s(t,e,r){t.on,t.bind;var o=t.children,a=t.nodeType,c=t.tag,p=t.text,l=n(t,["on","bind","children","nodeType","tag","text"]),h=(e.on,e.bind,e.children),f=e.nodeType,u=e.tag,d=e.text,y=n(e,["on","bind","children","nodeType","tag","text"]),v={};if(a===f)if(1===a||"component"===a)if(c===u){var _=function(t,e){var n,r,o={};for(var s in t)if(i(t[s]))t[s]!==e[s]&&(o=Object.assign({},o,((n={})[s]=t[s],n)));else for(var a in t[s])t[s][a]!==e[s][a]&&(o[s]=Object.assign({},o&&o[s],((r={})[a]=t[s][a],r)));return o}(l,y),g=function(t,e,n){var r={};if(t&&e){if(t.length===e.length)for(var o=0;o<t.length;o++){var i=s(t[o],e[o],n+"-"+o);Object.keys(i).length>0&&(r=Object.assign({},r,i))}else if(t.length>e.length){for(o=0;o<t.length;o++)if(o<=e.length-1){i=s(t[o],e[o],n+"-"+o);Object.keys(i).length>0&&(r=Object.assign({},r,i))}r[n]=Object.assign({},r[n],{add:t.slice(e.length-t.length)})}else if(t.length<e.length){for(o=0;o<t.length;o++){i=s(t[o],e[o],n+"-"+o);Object.keys(i).length>0&&(r=Object.assign({},r,i))}r[n]=Object.assign({},r[n],{remove:e.length-t.length})}return r}}(o,h,r);Object.keys(_).length>0&&(v[r]=Object.assign({},v[r],_)),g&&(v=Object.assign({},v,g))}else 1===a?v[r]=Object.assign({},v[r],{freshEle:r}):"component"===a&&(v[r]=Object.assign({},v[r],{updateComponent:"这里是要被替换的component的 名字 key "+c}));else 3===a&&p!==d&&(v[r]=Object.assign({},v[r],{text:p}));else v[r]=Object.assign({},v[r],{freshEle:r});return v}function a(t,e,n){var r=s(t,e,"0");Object.keys(r).length>0&&function(t,e,n,r){var o=function(o){var s=function(t,e){for(var n=e,r=t.split("-"),o=1;o<r.length;o++)n=n.childNodes[r[o]];return n}(o,e.$el),a=function(a){if("remove"===a)for(var p=0;p<t[o][a];p++)s.removeChild(s.lastChild);else if("add"===a)for(p=0;p<t[o][a].length;p++)if("component"===t[o][a][p].nodeType){var l=new c(t[o][a][p].component);s.appendChild(l.$el)}else s.appendChild(e._createElement(t[o][a][p]));else if("freshEle"===a){var h=t[o][a].split("-"),f=n;for(p=1;p<h.length;p++)f=f.children[h[p]];"component"===f.nodeType?(f.component=new c(f.component),s.parentNode.replaceChild(f.component.$el,s)):s.parentNode.replaceChild(e._createElement(f),s)}else if("text"===a)s.nodeValue=t[o][a];else if("props"===a){h=o.split("-");var u=r,d=n;for(p=1;p<h.length;p++)u=u.children[h[p]],d=d.children[h[p]];u.component._updateChildComponent(d.component,u.component._vNode)}else if("style"===a)for(var y in t[o][a])s[a][y]=t[o][a][y];else if("className"===a)if(i(t[o][a]))s[a]=t[o][a];else{var v=Object.keys(t[o][a]).filter((function(e){return t[o][a][e]}));s[a]=v.join(" ")}};for(var p in t[o])a(p)};for(var s in t)o(s)}(r,n,t,e)}Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw TypeError("Bind must be called on a function");var e=Array.prototype.slice.call(arguments,1),n=this,r=function(){},o=function(){return n.apply(this instanceof r?this:t,e.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(r.prototype=this.prototype),o.prototype=new r,o}),Array.isArray||(Array.isArray=function(t){return Boolean(t&&"[object Array]"===Object.prototype.toString.call(Object(t)))}),Array.prototype.find||(Array.prototype.find=function(t){var e;if(t){for(var n=this,r=0;r<n.length;r++)if(t(n[r],r)){e=n[r];break}}else console.error("[Find]: params[0] is invalid");return e}),Array.prototype.findIndex||(Array.prototype.findIndex=function(t){var e=-1;if(t){for(var n=0;n<this.length;n++)if(t(this[n],n)){e=n;break}}else console.error("[FindIndex]: params[0] is invalid");return e}),Object.keys||(Object.keys=function(t){var e=[];for(var n in t)e.push(n);return e}),Array.prototype.map||(Array.prototype.map=function(t){for(var e=[],n=this.slice(0),r=0;r<n.length;r++)e.push(t(n[r],r,n));return e}),Array.prototype.filter||(Array.prototype.filter=function(t){for(var e=[],n=this.slice(0),r=0;r<n.length;r++)t(n[r],r)&&e.push(n[r]);return e}),"function"!=typeof Object.assign&&(Object.assign=function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),r=1;r<arguments.length;r++){var o=arguments[r];if(null!=o)for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])}return n});var c=function(){function t(t){this.name=t.name,this.props=t.props,this.methods=t.methods,this.watch=t.watch,this.render=t.render,this.components=t.components,this.data=t.data,this.created=t.created,this.mounted=t.mounted,this._vNode,this._binds,this._tickersList=[],this.$el,this.$parent,this._patchTimer=null,this._isMounted=!1,this.eventFilter={stop:function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},prevent:function(t){t.preventDefault?t.preventDefault():t.returnValue=!1}},this._createComponent()}return t.prototype.__setEvents=function(t,e){var n=this,r=function(r){var o=r.split("."),i=o[0],s=o[1],a=e[r],c=a[0],p=a.slice(1);t["on"+i]=null,t["on"+i]=function(t){var e=t||window.event;s&&n.eventFilter[s]&&n.eventFilter[s](e),p=p.reduce((function(t,n){return"$event"===n?t.push(e):t.push(n),t}),[]),c.apply(n,p)}};for(var o in e)r(o)},t.prototype.__setStyle=function(t,e){for(var n in e)t.style[n]=e[n]},t.prototype.__setAttributes=function(t,e){var n=function(n){if("className"===n)o(e[n])?t[n]=Object.keys(e[n]).filter((function(t){return e[n][t]})).join(" "):i(e[n])?t[n]=e[n]:r("The className must be string or object");else if("on"===n)s.__setEvents(t,e[n]);else if("style"===n)s.__setStyle(t,e[n]);else if("attrs"===n)for(var a in e[n])t[a]=e[n][a]},s=this;for(var a in e)n(a)},t.prototype._createElement=function(t){var e;if(1===t.nodeType?(e=document.createElement(t.tag),this.__setAttributes(e,t)):3===t.nodeType?e=document.createTextNode(t.text):"component"===t.nodeType&&(e=this.components[t.tag].$el),t.children&&t.children.length>0)for(var n=0,r=t.children;n<r.length;n++){var o=r[n];"component"===o.nodeType?e.appendChild(o.component.$el):e.appendChild(this._createElement(o))}return e},t.prototype.__transferMethods=function(){Object.assign(this,e({},this.methods))},t.prototype.__deepClone=function(e){var n={};for(var r in e)e.hasOwnProperty(r)&&("object"!=typeof e[r]||e[r]instanceof t?n[r]=e[r]:n[r]=this.__deepClone(e[r]));return n},t.prototype._createVnode=function(n,r,i){var s,a;if(i&&i.length>0&&(s=i.reduce((function(t,e){return o(e)?t.push(e):t.push({nodeType:3,text:e}),t}),[])),this.components&&this.components[n]){this.components[n].$parent=this;var c=this.__deepClone(this.components[n]);if(r.props&&c.props)for(var p in c.props)(r.props[p]||!1===r.props[p]||0===r.props[p])&&(c.props[p]=Object.assign(c.props[p],{value:r.props[p]}));r.bind&&(this._binds=Object.assign({},this._binds,r.bind)),this._isMounted||(c=new t(c)),a=e(e({tag:n},r),{children:s,component:c,nodeType:"component"})}else a=e(e({tag:n},r),{children:s,nodeType:1});return a},t.prototype.$get=function(t){return this.data[t]||!1===this.data[t]||0===this.data[t]?this.data[t]:this.props&&this.props[t].value||this.props[t].initial},t.prototype.__watchTrigger=function(t,e){this.watch&&this.watch[t]&&this.watch[t].call(this,e,this.data[t])},t.prototype.$set=function(t,e){var n=this;this.data[t]!==e&&(this.__watchTrigger(t,e),this.data[t]=e,clearTimeout(this._patchTimer),this._patchTimer=setTimeout((function(){n._isMounted||(n._isMounted=!0);var t=n.render(n._createVnode.bind(n));a(t,n._vNode,n),n._vNode=t;for(var e=0,r=n._tickersList;e<r.length;e++){r[e].call(n)}n._tickersList=[]}),0))},t.prototype.$nextTick=function(t){this._tickersList.push(t)},t.prototype._updateChildComponent=function(e,n){a(new t(e)._vNode,n,this);for(var r=0,o=this._tickersList;r<o.length;r++){o[r].call(this)}this._tickersList=[]},t.prototype.$emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.$parent._binds[t]&&this.$parent._binds[t].apply(this.$parent,e)},t.prototype._createComponent=function(){this.render?(this._patchTimer=null,this.__transferMethods(),this.created&&this.created(),this._vNode=this.render(this._createVnode.bind(this)),this.$el=this._createElement(this._vNode)):r("The component named ["+this.name+"]'s render function is required")},t}(),p=function(e){function n(t){var n=e.call(this)||this,r=Object.assign({el:"#app",autoRender:!0},t),o=r.el,i=r.autoRender,s=r.render;return n.el=o,n.render=s,n.autoRender=i,n.children,n.__init(),n}return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}(n,e),n.prototype.__init=function(){this.el&&document.querySelector(this.el)?this.render?(this._el=document.querySelector(this.el),this.children=this.render(this._c.bind(this)),this._el.appendChild(this.children.$el),this.children.mounted&&this.children.mounted()):r("The render function is required, please check"):r("Please set valid el value, then I can get correct mounted element")},n}(function(){function t(){}return t.prototype._c=function(t){return new c(t)},t}());export default p;
