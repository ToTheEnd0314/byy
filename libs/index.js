/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};var e=function(){return(e=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function n(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n}function r(t){console.error("Moon Error:\n"+t)}function o(t){return"[object Object]"===Object.prototype.toString.call(t)}function i(t){return"[object String]"===Object.prototype.toString.call(t)}function s(t,e,r){t.on,t.bind;var o=t.children,a=t.nodeType,p=t.tag,c=t.text,l=n(t,["on","bind","children","nodeType","tag","text"]),h=(e.on,e.bind,e.children),u=e.nodeType,f=e.tag,d=e.text,y=n(e,["on","bind","children","nodeType","tag","text"]),v={};if(a===u)if(1===a||"component"===a)if(p===f){var g=function(t,e){var n,r,o={};for(var s in t)if(i(t[s]))t[s]!==e[s]&&(o=Object.assign({},o,((n={})[s]=t[s],n)));else if("className"===s)o[s]=t[s];else for(var a in t[s])t[s][a]!==e[s][a]&&(o[s]=Object.assign({},o&&o[s],((r={})[a]=t[s][a],r)));return o}(l,y),m=function(t,e,n){var r={};if(t&&e){if(t.length===e.length)for(var o=0;o<t.length;o++){var i=s(t[o],e[o],n+"-"+o);Object.keys(i).length>0&&(r=Object.assign({},r,i))}else if(t.length>e.length){for(o=0;o<t.length;o++)if(o<=e.length-1){i=s(t[o],e[o],n+"-"+o);Object.keys(i).length>0&&(r=Object.assign({},r,i))}r[n]=Object.assign({},r[n],{add:t.slice(e.length-t.length)})}else if(t.length<e.length){for(o=0;o<t.length;o++){i=s(t[o],e[o],n+"-"+o);Object.keys(i).length>0&&(r=Object.assign({},r,i))}r[n]=Object.assign({},r[n],{remove:e.length-t.length})}return r}}(o,h,r);Object.keys(g).length>0&&(v[r]=Object.assign({},v[r],g)),m&&(v=Object.assign({},v,m))}else 1===a?v[r]=Object.assign({},v[r],{freshEle:r}):"component"===a&&(v[r]=Object.assign({},v[r],{updateComponent:"这里是要被替换的component的 名字 key "+p}));else 3===a&&c!==d&&(v[r]=Object.assign({},v[r],{text:c}));else v[r]=Object.assign({},v[r],{freshEle:r});return v}function a(t,e,n){var r=s(t,e,"0");Object.keys(r).length>0&&function(t,e,n,r){var o=function(o){var s=function(t,e){for(var n=e,r=t.split("-"),o=1;o<r.length;o++)n=n.childNodes[r[o]];return n}(o,e.$el),a=function(a){if("remove"===a)for(var c=0;c<t[o][a];c++)s.removeChild(s.lastChild);else if("add"===a)for(c=0;c<t[o][a].length;c++)if("component"===t[o][a][c].nodeType){var l=new p(t[o][a][c].component);s.appendChild(l.$el)}else s.appendChild(e._createElement(t[o][a][c]));else if("freshEle"===a){var h=t[o][a].split("-"),u=n;for(c=1;c<h.length;c++)u=u.children[h[c]];"component"===u.nodeType?(u.component=new p(u.component),s.parentNode.replaceChild(u.component.$el,s)):s.parentNode.replaceChild(e._createElement(u),s)}else if("text"===a)s.nodeValue=t[o][a];else if("props"===a){h=o.split("-");var f=n,d=r;for(c=1;c<h.length;c++)f=f.children[h[c]],d=d.children[h[c]];d.component._updateChildComponent(s,f.component,d.component,t[o][a])}else if("style"===a)for(var y in t[o][a])s[a][y]=t[o][a][y];else if("className"===a)if(i(t[o][a]))s[a]=t[o][a];else{var v=Object.keys(t[o][a]).filter((function(e){return t[o][a][e]}));s[a]=v.join(" ")}else s[a]=t[o][a]};for(var c in t[o])a(c)};for(var s in t)o(s)}(r,n,t,e)}Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw TypeError("Bind must be called on a function");var e=Array.prototype.slice.call(arguments,1),n=this,r=function(){},o=function(){return n.apply(this instanceof r?this:t,e.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(r.prototype=this.prototype),o.prototype=new r,o}),Array.isArray||(Array.isArray=function(t){return Boolean(t&&"[object Array]"===Object.prototype.toString.call(Object(t)))}),Array.prototype.find||(Array.prototype.find=function(t){var e;if(t){for(var n=this,r=0;r<n.length;r++)if(t(n[r],r)){e=n[r];break}}else console.error("[Find]: params[0] is invalid");return e}),Array.prototype.findIndex||(Array.prototype.findIndex=function(t){var e=-1;if(t){for(var n=0;n<this.length;n++)if(t(this[n],n)){e=n;break}}else console.error("[FindIndex]: params[0] is invalid");return e}),Object.keys||(Object.keys=function(t){var e=[];for(var n in t)e.push(n);return e}),Array.prototype.map||(Array.prototype.map=function(t){for(var e=[],n=this.slice(0),r=0;r<n.length;r++)e.push(t(n[r],r,n));return e}),Array.prototype.filter||(Array.prototype.filter=function(t){for(var e=[],n=this.slice(0),r=0;r<n.length;r++)t(n[r],r)&&e.push(n[r]);return e}),"function"!=typeof Object.assign&&(Object.assign=function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),r=1;r<arguments.length;r++){var o=arguments[r];if(null!=o)for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])}return n}),Array.prototype.reduce||(Array.prototype.reduce=function(t){if(null===this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof t)throw new TypeError(t+" is not a function");var e,n=Object(this),r=n.length>>>0,o=0;if(arguments.length>=2)e=arguments[1];else{for(;o<r&&!(o in n);)o++;if(o>=r)throw new TypeError("Reduce of empty array with no initial value");e=n[o++]}for(;o<r;)o in n&&(e=t(e,n[o],o,n)),o++;return e}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){var n;if(null==this)throw new TypeError('"this" is null or not defined');var r=Object(this),o=r.length>>>0;if(0===o)return-1;var i=+e||0;if(Math.abs(i)===Infinity&&(i=0),i>=o)return-1;for(n=Math.max(i>=0?i:o-Math.abs(i),0);n<o;){if(n in r&&r[n]===t)return n;n++}return-1});var p=function(){function t(t){this.name=t.name,this.props=t.props,this.methods=t.methods,this.watch=t.watch,this.render=t.render,this.components=t.components,this.data=t.data,this.created=t.created,this.mounted=t.mounted,this._vNode,this._binds,this._tickersList=[],this.$el,this.$parent,this._patchTimer=null,this.eventFilter={stop:function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},prevent:function(t){t.preventDefault?t.preventDefault():t.returnValue=!1}},this._createComponent()}return t.prototype.__setEvents=function(t,e){var n=this,r=function(r){var o=r.split("."),i=o[0],s=o[1],a=e[r],p=a[0],c=a.slice(1);t["on"+i]=null,t["on"+i]=function(t){var e=t||window.event;s&&n.eventFilter[s]&&n.eventFilter[s](e),c=c.reduce((function(t,n){return"$event"===n?t.push(e):t.push(n),t}),[]),p.apply(n,c)}};for(var o in e)r(o)},t.prototype.__setStyle=function(t,e){for(var n in e)t.style.setAttribute?t.style.setAttribute(n,e[n]):t.style[n]=e[n]},t.prototype.__setAttributes=function(t,e){var n=function(n){"className"===n?o(e[n])?t[n]=Object.keys(e[n]).filter((function(t){return e[n][t]})).join(" "):i(e[n])?t[n]=e[n]:r("The className must be string or object"):"on"===n?s.__setEvents(t,e[n]):"style"===n?s.__setStyle(t,e[n]):"component"!==n&&"nodeType"!==n&&"children"!==n&&"tag"!==n&&(t[n]=e[n])},s=this;for(var a in e)n(a)},t.prototype._createElement=function(t){var e;if(1===t.nodeType?(e=document.createElement(t.tag),this.__setAttributes(e,t)):3===t.nodeType?e=document.createTextNode(t.text):"component"===t.nodeType&&(e=t.component.$el),t.children&&t.children.length>0)for(var n=0,r=t.children;n<r.length;n++){var o=r[n];"component"===o.nodeType?e.appendChild(o.component.$el):e.appendChild(this._createElement(o))}return e},t.prototype.__transferMethods=function(){Object.assign(this,e({},this.methods))},t.prototype.__deepClone=function(e){var n={};for(var r in e)e.hasOwnProperty(r)&&(!o(e[r])||e[r]instanceof t?n[r]=e[r]:n[r]=this.__deepClone(e[r]));return n},t.prototype._createVnode=function(n,r,i){var s,a,p=1;if(this.components&&this.components[n]){if(s=this.__deepClone(this.components[n]),r&&r.props&&s.props)for(var c in s.props)(r.props[c]||!1===r.props[c]||0===r.props[c])&&(s.props[c]=Object.assign(s.props[c],{value:r.props[c]}));r&&r.bind&&(this._binds=Object.assign({},this._binds,r.bind)),(s=new t(s)).$parent=this,p="component"}return i&&i.length>0&&(a=i.reduce((function(t,e){return o(e)?t.push(e):t.push({nodeType:3,text:e}),t}),[])),e(e({tag:n,children:a},r),{component:s,nodeType:p})},t.prototype.$get=function(t){return this.data[t]?this.data[t]||!1===this.data[t]||0===this.data[t]||""===this.data[t]?this.data[t]:undefined:this.props&&this.props[t]?this.props[t].value||""===this.props[t].value||0===this.props[t].value||!1===this.props[t].value?this.props[t].value:this.props[t].initial||""===this.props[t].initial||0===this.props[t].initial||!1===this.props[t].initial?this.props[t].initial:undefined:undefined},t.prototype.__watchTrigger=function(t,e){var n=this.$get(t);this.watch&&this.watch[t]&&this.watch[t].call(this,e,n)},t.prototype.$set=function(e,n){var r=this;this.data[e]!==n&&(this.__watchTrigger(e,n),this.data[e]=n,clearTimeout(this._patchTimer),this._patchTimer=setTimeout((function(){var e=new t(r)._vNode;a(e,r._vNode,r),r._vNode=e;for(var n=0,o=r._tickersList;n<o.length;n++){o[n].call(r)}r._tickersList=[]}),0))},t.prototype.$nextTick=function(t){this._tickersList.push(t)},t.prototype._updateChildComponent=function(t,e,n,r){for(var o in this.$el=t,r)this.__watchTrigger(o,r[o]);var i=e._vNode;a(i,n._vNode,this),this._vNode=i;for(var s=0,p=this._tickersList;s<p.length;s++){p[s].call(this)}this._tickersList=[]},t.prototype.$emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.$parent._binds[t]&&this.$parent._binds[t].apply(this.$parent,e)},t.prototype._createComponent=function(){this.render?(this._patchTimer=null,this.__transferMethods(),this.created&&this.created(),this._vNode=this.render(this._createVnode.bind(this)),this.$el=this._createElement(this._vNode)):r("The component named ["+this.name+"]'s render function is required")},t}(),c=function(e){function n(t){var n=e.call(this)||this,r=Object.assign({el:"#app",autoRender:!0},t),o=r.el,i=r.autoRender,s=r.render,a=r.autoMode;return n.el=o,n.render=s,n._autoMode=a,n.autoRender=i,n.children,n.__init(),n}return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}(n,e),n.prototype._mountedTrigger=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];"component"===r.nodeType&&r.component.mounted&&r.component.mounted(),r.children&&this._mountedTrigger(r.children)}},n.prototype.$mount=function(){this._el=document.querySelector(this.el),this._el.appendChild(this.children.$el),this.children.mounted&&this.children.mounted(),this._mountedTrigger(this.children._vNode.children)},n.prototype.__init=function(){this.el&&document.querySelector(this.el)?this.render?(this.children=this.render(this._c.bind(this)),this._autoMode&&this.$mount()):r("The render function is required, please check"):r("Please set valid el value, then I can get correct mounted element")},n}(function(){function t(){}return t.prototype._c=function(t){return new p(t)},t}());export default c;
